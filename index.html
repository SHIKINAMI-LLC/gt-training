<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GT RACER TRAINING APP</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'racing-red': '#DC2626',
            'racing-orange': '#F97316',
            'racing-yellow': '#FBBF24',
            'bg-dark': '#111827',
            'bg-card': '#1F2937',
          }
        }
      }
    }
  </script>
  <style>
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    .tab-active {
      color: #DC2626;
    }
    .tab-inactive {
      color: #9CA3AF;
    }
    @keyframes slideIn {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .animate-slide-in {
      animation: slideIn 0.3s ease-out;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    .animate-pulse-once {
      animation: pulse 0.5s ease-in-out;
    }
  </style>
</head>
<body class="bg-bg-dark text-white min-h-screen">

  <!-- Main Container -->
  <div id="app" class="pb-20"></div>

  <!-- Bottom Navigation -->
  <nav class="fixed bottom-0 left-0 right-0 bg-bg-card border-t border-gray-700 px-4 py-3 z-50">
    <div class="flex justify-around items-center">
      <button onclick="showPage('home')" id="tab-home" class="flex flex-col items-center gap-1 tab-active">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
        </svg>
        <span class="text-xs">ãƒ›ãƒ¼ãƒ </span>
      </button>
      <button onclick="showPage('progress')" id="tab-progress" class="flex flex-col items-center gap-1 tab-inactive">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
        </svg>
        <span class="text-xs">é€²æ—</span>
      </button>
      <button onclick="showPage('history')" id="tab-history" class="flex flex-col items-center gap-1 tab-inactive">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
        <span class="text-xs">å±¥æ­´</span>
      </button>
      <button onclick="showPage('settings')" id="tab-settings" class="flex flex-col items-center gap-1 tab-inactive">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
        </svg>
        <span class="text-xs">è¨­å®š</span>
      </button>
    </div>
  </nav>

  <!-- EXP Gain Modal -->
  <div id="exp-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
    <div class="text-center animate-pulse-once">
      <div id="exp-amount" class="text-6xl font-bold text-racing-yellow mb-4">+100 EXP!</div>
      <div id="rank-up-msg" class="text-2xl font-bold text-white hidden">ğŸ‰ ãƒ©ãƒ³ã‚¯ã‚¢ãƒƒãƒ—ï¼</div>
    </div>
  </div>

  <script>
    // ========== DATA ==========
    const RANKS = [
      { rank: 'Rookie', minExp: 0, maxExp: 499, color: '#10B981', icon: 'ğŸŸ¢' },
      { rank: 'Amateur', minExp: 500, maxExp: 1499, color: '#3B82F6', icon: 'ğŸ”µ' },
      { rank: 'Semi-Pro', minExp: 1500, maxExp: 2999, color: '#FBBF24', icon: 'ğŸŸ¡' },
      { rank: 'Pro', minExp: 3000, maxExp: 4999, color: '#F97316', icon: 'ğŸŸ ' },
      { rank: 'Elite', minExp: 5000, maxExp: 7499, color: '#DC2626', icon: 'ğŸ”´' },
      { rank: 'Legend', minExp: 7500, maxExp: Infinity, color: '#000000', icon: 'âš«' },
    ];

    const WEEK1_MISSIONS = [
      {
        date: '2026-02-18',
        dayNumber: 1,
        dayName: 'LOWER POWER',
        missions: [
          {
            id: 'm1-req1',
            type: 'required1',
            title: 'å¿…é ˆ1: ãƒ¢ãƒ“ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³',
            description: 'åã‚Šè…°æ”¹å–„ + å·¦è‚©ãƒªãƒãƒ“ãƒª',
            duration: '10-15åˆ†',
            exp: 50,
            exercises: [
              { name: 'ã‚­ãƒ£ãƒƒãƒˆã‚«ã‚¦', detail: '10å›' },
              { name: 'ãƒ‡ãƒƒãƒ‰ãƒã‚°', detail: 'å·¦å³10å›Ã—2ã‚»ãƒƒãƒˆ' },
              { name: 'ã‚°ãƒ«ãƒ¼ãƒˆãƒ–ãƒªãƒƒã‚¸', detail: '15å›Ã—2ã‚»ãƒƒãƒˆ' },
              { name: 'è…¸è…°ç­‹ã‚¹ãƒˆãƒ¬ãƒƒãƒ', detail: 'å·¦å³30ç§’Ã—2ã‚»ãƒƒãƒˆ' },
              { name: 'ã‚¯ãƒ©ãƒ ã‚·ã‚§ãƒ«', detail: 'å·¦å³15å›Ã—2ã‚»ãƒƒãƒˆ' }
            ]
          },
          {
            id: 'm1-req2',
            type: 'required2',
            title: 'å¿…é ˆ2: ä¸‹åŠèº«ãƒ‘ãƒ¯ãƒ¼ + ä½“å¹¹',
            description: 'ã‚°ãƒ«ãƒ¼ãƒˆãƒ–ãƒªãƒƒã‚¸ã€ãƒ–ãƒ«ã‚¬ãƒªã‚¢ãƒ³ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆã€ãƒ—ãƒ©ãƒ³ã‚¯',
            duration: '20åˆ†',
            exp: 100,
            exercises: [
              { name: 'ã‚°ãƒ«ãƒ¼ãƒˆãƒ–ãƒªãƒƒã‚¸å¼·åŒ–ç‰ˆ', detail: '20å›Ã—3ã‚»ãƒƒãƒˆ' },
              { name: 'ãƒ–ãƒ«ã‚¬ãƒªã‚¢ãƒ³ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ', detail: 'å·¦å³12å›Ã—3ã‚»ãƒƒãƒˆ' },
              { name: 'ã‚«ãƒ¼ãƒ•ãƒ¬ã‚¤ã‚º', detail: '20å›Ã—3ã‚»ãƒƒãƒˆ' },
              { name: 'ãƒ—ãƒ©ãƒ³ã‚¯', detail: '3åˆ†Ã—2ã‚»ãƒƒãƒˆ' },
              { name: 'ãƒ¬ãƒƒã‚°ãƒ¬ã‚¤ã‚º', detail: '15å›Ã—3ã‚»ãƒƒãƒˆ' }
            ]
          },
          {
            id: 'm1-bonus',
            type: 'bonus',
            title: 'ãƒœãƒ¼ãƒŠã‚¹: è¿½åŠ HIIT',
            description: 'ã‚¿ãƒã‚¿å¼ãƒã‚¦ãƒ³ãƒ†ãƒ³ã‚¯ãƒ©ã‚¤ãƒãƒ¼',
            duration: '3åˆ†',
            exp: 50,
            exercises: [
              { name: 'ãƒã‚¦ãƒ³ãƒ†ãƒ³ã‚¯ãƒ©ã‚¤ãƒãƒ¼', detail: '20ç§’å…¨åŠ› / 10ç§’ä¼‘æ†© Ã— 4ãƒ©ã‚¦ãƒ³ãƒ‰' }
            ]
          }
        ]
      },
      {
        date: '2026-02-19',
        dayNumber: 2,
        dayName: 'ZONE 2 CARDIO',
        missions: [
          {
            id: 'm2-req1',
            type: 'required1',
            title: 'å¿…é ˆ1: ãƒ¢ãƒ“ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³',
            description: 'åã‚Šè…°æ”¹å–„ + å·¦è‚©ãƒªãƒãƒ“ãƒª',
            duration: '10-15åˆ†',
            exp: 50,
            exercises: [
              { name: 'ã‚­ãƒ£ãƒƒãƒˆã‚«ã‚¦', detail: '10å›' },
              { name: 'ãƒ‡ãƒƒãƒ‰ãƒã‚°', detail: 'å·¦å³10å›Ã—2ã‚»ãƒƒãƒˆ' },
              { name: 'ã‚°ãƒ«ãƒ¼ãƒˆãƒ–ãƒªãƒƒã‚¸', detail: '15å›Ã—2ã‚»ãƒƒãƒˆ' },
              { name: 'è…¸è…°ç­‹ã‚¹ãƒˆãƒ¬ãƒƒãƒ', detail: 'å·¦å³30ç§’Ã—2ã‚»ãƒƒãƒˆ' },
              { name: 'ã‚¯ãƒ©ãƒ ã‚·ã‚§ãƒ«', detail: 'å·¦å³15å›Ã—2ã‚»ãƒƒãƒˆ' }
            ]
          },
          {
            id: 'm2-req2',
            type: 'required2',
            title: 'å¿…é ˆ2: ã‚µã‚¤ã‚¯ãƒªãƒ³ã‚° Zone 2',
            description: 'å¿ƒæ‹110-130bpm',
            duration: '40-50åˆ†',
            exp: 100,
            exercises: [
              { name: 'ã‚µã‚¤ã‚¯ãƒªãƒ³ã‚°', detail: 'Zone 2ã€40-50åˆ†' }
            ]
          },
          {
            id: 'm2-bonus',
            type: 'bonus',
            title: 'ãƒœãƒ¼ãƒŠã‚¹: è¿½åŠ 10åˆ†å»¶é•·',
            description: 'åˆè¨ˆ60åˆ†',
            duration: '10åˆ†',
            exp: 50,
            exercises: [
              { name: 'ã‚µã‚¤ã‚¯ãƒªãƒ³ã‚°å»¶é•·', detail: '+10åˆ†ï¼ˆåˆè¨ˆ60åˆ†ï¼‰' }
            ]
          }
        ]
      },
      {
        date: '2026-02-20',
        dayNumber: 3,
        dayName: 'UPPER + NECK',
        missions: [
          {
            id: 'm3-req1',
            type: 'required1',
            title: 'å¿…é ˆ1: ãƒ¢ãƒ“ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³',
            description: 'åã‚Šè…°æ”¹å–„ + å·¦è‚©ãƒªãƒãƒ“ãƒª',
            duration: '10-15åˆ†',
            exp: 50,
            exercises: [
              { name: 'ã‚­ãƒ£ãƒƒãƒˆã‚«ã‚¦', detail: '10å›' },
              { name: 'ãƒ‡ãƒƒãƒ‰ãƒã‚°', detail: 'å·¦å³10å›Ã—2ã‚»ãƒƒãƒˆ' },
              { name: 'ã‚°ãƒ«ãƒ¼ãƒˆãƒ–ãƒªãƒƒã‚¸', detail: '15å›Ã—2ã‚»ãƒƒãƒˆ' }
            ]
          },
          {
            id: 'm3-req2',
            type: 'required2',
            title: 'å¿…é ˆ2: ä¸ŠåŠèº«ç­‹åŠ› + é¦–Gå¼·åŒ–',
            description: 'æ‡¸å‚ã€è…•ç«‹ã¦ã€é¦–ãƒˆãƒ¬',
            duration: '20åˆ†',
            exp: 100,
            exercises: [
              { name: 'æ‡¸å‚', detail: '3å›Ã—3ã‚»ãƒƒãƒˆ' },
              { name: 'è…•ç«‹ã¦ä¼ã›', detail: '20å›Ã—3ã‚»ãƒƒãƒˆ' },
              { name: 'ãƒ‹ãƒ¼ãƒ¬ã‚¤ã‚º', detail: '15å›Ã—3ã‚»ãƒƒãƒˆ' },
              { name: 'é¦–Gãƒ•ã‚©ãƒ¼ã‚¹å¯¾ç­–', detail: 'ã‚¢ã‚¤ã‚½ãƒ¡ãƒˆãƒªãƒƒã‚¯å„æ–¹å‘10ç§’Ã—3' }
            ]
          },
          {
            id: 'm3-bonus',
            type: 'bonus',
            title: 'ãƒœãƒ¼ãƒŠã‚¹: é¦–Gãƒ•ã‚©ãƒ¼ã‚¹å¼·åŒ–',
            description: 'è¿½åŠ 5åˆ†',
            duration: '5åˆ†',
            exp: 50,
            exercises: [
              { name: 'ãƒ¬ã‚¸ã‚¹ã‚¿ãƒ³ã‚¹ãƒãƒ³ãƒ‰é¦–ãƒˆãƒ¬', detail: 'å„æ–¹å‘15å›' }
            ]
          }
        ]
      }
    ];

    // ========== STATE MANAGEMENT ==========
    let appData = {
      profile: {
        name: 'Boss',
        startDate: '2026-02-18',
        currentRank: 'Rookie',
        totalExp: 0,
        currentStreak: 0,
        longestStreak: 0
      },
      history: []
    };

    function loadData() {
      const saved = localStorage.getItem('gt-racer-app-data');
      if (saved) {
        appData = JSON.parse(saved);
      }
    }

    function saveData() {
      localStorage.setItem('gt-racer-app-data', JSON.stringify(appData));
    }

    function getTodayMissions() {
      const today = new Date().toISOString().split('T')[0];
      return WEEK1_MISSIONS.find(m => m.date === today) || WEEK1_MISSIONS[0];
    }

    function getTodayRecord() {
      const today = new Date().toISOString().split('T')[0];
      return appData.history.find(h => h.date === today);
    }

    function isMissionCompleted(missionId) {
      const record = getTodayRecord();
      return record?.completions.some(c => c.missionId === missionId) || false;
    }

    function getRankByExp(exp) {
      for (const rank of RANKS) {
        if (exp >= rank.minExp && exp <= rank.maxExp) {
          return rank.rank;
        }
      }
      return 'Rookie';
    }

    function getNextRankInfo(currentExp) {
      const currentRank = RANKS.find(r => currentExp >= r.minExp && currentExp <= r.maxExp);
      const currentIndex = RANKS.findIndex(r => r.rank === currentRank?.rank);
      const nextRank = RANKS[currentIndex + 1];

      if (!nextRank) {
        return { nextRank: 'Legend', nextRankExp: Infinity, progress: 100 };
      }

      const progress = ((currentExp - currentRank.minExp) / (nextRank.minExp - currentRank.minExp)) * 100;
      return {
        nextRank: nextRank.rank,
        nextRankExp: nextRank.minExp,
        progress: Math.min(Math.round(progress), 100)
      };
    }

    function completeMission(missionId, exp) {
      const today = new Date().toISOString().split('T')[0];
      const todayRecord = getTodayRecord();

      if (!todayRecord) {
        appData.history.push({
          date: today,
          completions: [{ missionId, exp, completedAt: new Date().toISOString() }],
          totalExp: exp,
          isPerfectDay: false
        });
      } else {
        if (!todayRecord.completions.some(c => c.missionId === missionId)) {
          todayRecord.completions.push({ missionId, exp, completedAt: new Date().toISOString() });
          todayRecord.totalExp += exp;
        }
      }

      const oldRank = appData.profile.currentRank;
      appData.profile.totalExp += exp;
      appData.profile.currentRank = getRankByExp(appData.profile.totalExp);
      const rankUp = oldRank !== appData.profile.currentRank;

      saveData();
      showExpModal(exp, rankUp);
      return rankUp;
    }

    function showExpModal(exp, rankUp) {
      const modal = document.getElementById('exp-modal');
      const expAmount = document.getElementById('exp-amount');
      const rankUpMsg = document.getElementById('rank-up-msg');

      expAmount.textContent = `+${exp} EXP!`;
      rankUpMsg.classList.toggle('hidden', !rankUp);

      modal.classList.remove('hidden');
      setTimeout(() => {
        modal.classList.add('hidden');
        showPage(currentPage);
      }, 2000);
    }

    // ========== UI RENDERING ==========
    let currentPage = 'home';

    function showPage(page) {
      currentPage = page;

      // Update tabs
      ['home', 'progress', 'history', 'settings'].forEach(tab => {
        const el = document.getElementById(`tab-${tab}`);
        if (tab === page) {
          el.classList.remove('tab-inactive');
          el.classList.add('tab-active');
        } else {
          el.classList.remove('tab-active');
          el.classList.add('tab-inactive');
        }
      });

      // Render page
      const app = document.getElementById('app');
      if (page === 'home') app.innerHTML = renderHomePage();
      else if (page === 'progress') app.innerHTML = renderProgressPage();
      else if (page === 'history') app.innerHTML = renderHistoryPage();
      else if (page === 'settings') app.innerHTML = renderSettingsPage();
    }

    function renderHomePage() {
      const todayMissions = getTodayMissions();
      const nextRankInfo = getNextRankInfo(appData.profile.totalExp);
      const rankInfo = RANKS.find(r => r.rank === appData.profile.currentRank);

      return `
        <div class="px-4 pt-6 animate-slide-in">
          <!-- Rank & EXP -->
          <div class="bg-bg-card rounded-lg p-6 shadow-lg mb-6">
            <div class="flex justify-center mb-4">
              <div class="inline-flex items-center gap-2 text-white font-bold py-2 px-4 rounded-full shadow-lg" style="background-color: ${rankInfo.color}">
                <span class="text-2xl">${rankInfo.icon}</span>
                <span>${rankInfo.rank}</span>
              </div>
            </div>
            <div class="mb-2">
              <div class="flex justify-between text-sm text-gray-400 mb-1">
                <span>${appData.profile.totalExp} EXP</span>
                <span>${nextRankInfo.nextRankExp === Infinity ? appData.profile.totalExp : nextRankInfo.nextRankExp} EXP</span>
              </div>
              <div class="w-full bg-gray-700 rounded-full h-4 overflow-hidden">
                <div class="bg-gradient-to-r from-racing-red to-racing-orange h-full transition-all duration-500" style="width: ${nextRankInfo.progress}%"></div>
              </div>
              <div class="text-center text-sm text-gray-400 mt-1">${nextRankInfo.progress}%</div>
            </div>
            <p class="text-center text-sm text-gray-400 mt-2">
              æ¬¡ã®ãƒ©ãƒ³ã‚¯ï¼ˆ${nextRankInfo.nextRank}ï¼‰ã¾ã§ ${nextRankInfo.nextRankExp === Infinity ? 0 : nextRankInfo.nextRankExp - appData.profile.totalExp} EXP
            </p>
          </div>

          <!-- Today's Missions -->
          <div class="mb-6">
            <h2 class="text-2xl font-bold text-white mb-2">
              Day ${todayMissions.dayNumber}: ${todayMissions.dayName}
            </h2>
            <p class="text-sm text-gray-400 mb-4">${todayMissions.date}</p>

            <div class="space-y-4">
              ${todayMissions.missions.map(mission => renderMissionCard(mission)).join('')}
            </div>
          </div>

          <!-- Complete All Button -->
          <button onclick="completeAllMissions()" class="w-full bg-racing-red hover:bg-red-700 text-white font-bold py-4 px-6 rounded-lg shadow-lg transition-all duration-200 active:scale-95">
            å…¨ãƒŸãƒƒã‚·ãƒ§ãƒ³å®Œäº†
          </button>
        </div>
      `;
    }

    function renderMissionCard(mission) {
      const isCompleted = isMissionCompleted(mission.id);
      const borderColor = mission.type === 'required1' ? 'border-racing-red' : mission.type === 'required2' ? 'border-racing-orange' : 'border-racing-yellow';

      return `
        <div class="bg-bg-card rounded-lg p-4 shadow-lg border-l-4 ${borderColor} ${isCompleted ? 'opacity-50' : ''}">
          <div class="flex items-center justify-between mb-2">
            <div>
              <h3 class="text-lg font-bold text-white">${mission.title}</h3>
              <p class="text-sm text-gray-400">${mission.description}</p>
            </div>
            ${isCompleted ? '<span class="text-2xl">âœ…</span>' : ''}
          </div>
          <div class="flex items-center justify-between">
            <div class="flex gap-4 text-sm text-gray-400">
              <span>â±ï¸ ${mission.duration}</span>
              <span class="text-racing-yellow font-semibold">${mission.exp} EXP</span>
            </div>
            <button onclick="toggleMissionDetail('${mission.id}')" class="text-racing-red hover:text-red-400 transition-colors text-sm font-medium">
              è©³ç´° â–¼
            </button>
          </div>
          <div id="detail-${mission.id}" class="hidden mt-4 border-t border-gray-700 pt-4">
            ${mission.exercises.map(ex => `
              <div class="mb-2">
                <p class="text-white font-medium">${ex.name}</p>
                <p class="text-sm text-gray-400">${ex.detail}</p>
              </div>
            `).join('')}
            ${!isCompleted ? `<button onclick="completeSingleMission('${mission.id}', ${mission.exp})" class="mt-4 w-full bg-racing-orange hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-lg transition-all">ã“ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³å®Œäº†</button>` : ''}
          </div>
        </div>
      `;
    }

    function renderProgressPage() {
      const rankInfo = RANKS.find(r => r.rank === appData.profile.currentRank);
      const nextRankInfo = getNextRankInfo(appData.profile.totalExp);

      return `
        <div class="px-4 pt-6 animate-slide-in">
          <h2 class="text-3xl font-bold text-white mb-6">é€²æ—</h2>

          <!-- Total EXP & Rank -->
          <div class="bg-bg-card rounded-lg p-6 shadow-lg mb-6">
            <h3 class="text-xl font-bold text-white mb-4">ç´¯è¨ˆEXP</h3>
            <div class="text-5xl font-bold text-racing-yellow text-center mb-6">
              ${appData.profile.totalExp} EXP
            </div>

            <h3 class="text-xl font-bold text-white mb-4">ç¾åœ¨ã®ãƒ©ãƒ³ã‚¯</h3>
            <div class="flex justify-center mb-6">
              <div class="inline-flex items-center gap-2 text-white font-bold py-3 px-6 rounded-full shadow-lg text-xl" style="background-color: ${rankInfo.color}">
                <span class="text-3xl">${rankInfo.icon}</span>
                <span>${rankInfo.rank}</span>
              </div>
            </div>

            <h3 class="text-xl font-bold text-white mb-4">æ¬¡ã®ãƒ©ãƒ³ã‚¯ã¾ã§</h3>
            <div class="mb-2">
              <div class="flex justify-between text-sm text-gray-400 mb-1">
                <span>${appData.profile.totalExp} EXP</span>
                <span>${nextRankInfo.nextRankExp === Infinity ? appData.profile.totalExp : nextRankInfo.nextRankExp} EXP</span>
              </div>
              <div class="w-full bg-gray-700 rounded-full h-4 overflow-hidden">
                <div class="bg-gradient-to-r from-racing-red to-racing-orange h-full transition-all duration-500" style="width: ${nextRankInfo.progress}%"></div>
              </div>
              <div class="text-center text-sm text-gray-400 mt-1">${nextRankInfo.progress}%</div>
            </div>
          </div>

          <!-- Streak -->
          <div class="bg-bg-card rounded-lg p-6 shadow-lg mb-6">
            <h3 class="text-xl font-bold text-white mb-4">é€£ç¶šé”æˆæ—¥æ•°</h3>
            <div class="text-4xl font-bold text-racing-orange text-center mb-2">
              ğŸ”¥ ${appData.profile.currentStreak}æ—¥é€£ç¶š
            </div>
            <p class="text-center text-gray-400">æœ€é•·: ${appData.profile.longestStreak}æ—¥</p>
          </div>
        </div>
      `;
    }

    function renderHistoryPage() {
      const sortedHistory = [...appData.history].sort((a, b) => new Date(b.date) - new Date(a.date));

      return `
        <div class="px-4 pt-6 animate-slide-in">
          <h2 class="text-3xl font-bold text-white mb-6">å±¥æ­´</h2>

          ${sortedHistory.length === 0 ? '<p class="text-gray-400 text-center">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>' : ''}

          <div class="space-y-4">
            ${sortedHistory.map(record => {
              const dayMission = WEEK1_MISSIONS.find(m => m.date === record.date);
              return `
                <div class="bg-bg-card rounded-lg p-4 shadow-lg">
                  <div class="flex justify-between items-start mb-2">
                    <div>
                      <h3 class="text-lg font-bold text-white">${record.date} ${dayMission ? `(Day ${dayMission.dayNumber})` : ''}</h3>
                      ${dayMission ? `<p class="text-sm text-gray-400">${dayMission.dayName}</p>` : ''}
                    </div>
                    ${record.isPerfectDay ? '<span class="text-2xl">ğŸ‰</span>' : ''}
                  </div>
                  <div class="space-y-1 mb-2">
                    ${record.completions.map(c => `
                      <p class="text-sm text-green-400">âœ… ${c.missionId} (+${c.exp})</p>
                    `).join('')}
                  </div>
                  ${record.isPerfectDay ? '<p class="text-racing-yellow font-bold">Perfect Day!</p>' : ''}
                  <p class="text-white font-semibold mt-2">åˆè¨ˆ: +${record.totalExp} EXP</p>
                </div>
              `;
            }).join('')}
          </div>
        </div>
      `;
    }

    function renderSettingsPage() {
      return `
        <div class="px-4 pt-6 animate-slide-in">
          <h2 class="text-3xl font-bold text-white mb-6">è¨­å®š</h2>

          <!-- Profile -->
          <div class="bg-bg-card rounded-lg p-6 shadow-lg mb-6">
            <h3 class="text-xl font-bold text-white mb-4">ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«</h3>
            <p class="text-gray-400 mb-2">åå‰: <span class="text-white">${appData.profile.name}</span></p>
            <p class="text-gray-400 mb-2">é–‹å§‹æ—¥: <span class="text-white">${appData.profile.startDate}</span></p>
          </div>

          <!-- Data Management -->
          <div class="bg-bg-card rounded-lg p-6 shadow-lg mb-6">
            <h3 class="text-xl font-bold text-white mb-4">ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h3>
            <button onclick="exportData()" class="w-full bg-racing-orange hover:bg-orange-600 text-white font-bold py-3 px-6 rounded-lg mb-3 transition-all">
              ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
            </button>
            <button onclick="importData()" class="w-full bg-racing-orange hover:bg-orange-600 text-white font-bold py-3 px-6 rounded-lg mb-3 transition-all">
              ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
            </button>
            <button onclick="resetData()" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition-all">
              ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ
            </button>
          </div>

          <!-- App Info -->
          <div class="bg-bg-card rounded-lg p-6 shadow-lg">
            <h3 class="text-xl font-bold text-white mb-4">ã‚¢ãƒ—ãƒªæƒ…å ±</h3>
            <p class="text-gray-400">ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 1.0.0</p>
            <p class="text-gray-400 mt-2">GT RACER TRAINING APP</p>
          </div>
        </div>
      `;
    }

    // ========== ACTIONS ==========
    function toggleMissionDetail(missionId) {
      const detail = document.getElementById(`detail-${missionId}`);
      detail.classList.toggle('hidden');
    }

    function completeSingleMission(missionId, exp) {
      if (isMissionCompleted(missionId)) {
        alert('ã“ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³ã¯æ—¢ã«å®Œäº†ã—ã¦ã„ã¾ã™ï¼');
        return;
      }
      completeMission(missionId, exp);
    }

    function completeAllMissions() {
      const todayMissions = getTodayMissions();
      let totalExp = 0;
      let completedCount = 0;

      for (const mission of todayMissions.missions) {
        if (!isMissionCompleted(mission.id)) {
          completeMission(mission.id, mission.exp);
          totalExp += mission.exp;
          completedCount++;
        }
      }

      if (completedCount === 0) {
        alert('ä»Šæ—¥ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³å…¨ã¦å®Œäº†æ¸ˆã¿ã§ã™ï¼');
        return;
      }

      // Perfect Day bonus
      if (completedCount === todayMissions.missions.filter(m => m.type !== 'bonus').length) {
        completeMission('perfect-day-bonus', 50);
        totalExp += 50;
      }
    }

    function exportData() {
      const dataStr = JSON.stringify(appData, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'gt-racer-data-backup.json';
      a.click();
      alert('ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸï¼');
    }

    function importData() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'application/json';
      input.onchange = (e) => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            appData = JSON.parse(event.target.result);
            saveData();
            alert('ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸï¼');
            showPage(currentPage);
          } catch (err) {
            alert('ã‚¨ãƒ©ãƒ¼: ç„¡åŠ¹ãªãƒ•ã‚¡ã‚¤ãƒ«ã§ã™');
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }

    function resetData() {
      if (confirm('æœ¬å½“ã«ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
        localStorage.removeItem('gt-racer-app-data');
        appData = {
          profile: {
            name: 'Boss',
            startDate: '2026-02-18',
            currentRank: 'Rookie',
            totalExp: 0,
            currentStreak: 0,
            longestStreak: 0
          },
          history: []
        };
        saveData();
        alert('ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
        showPage('home');
      }
    }

    // ========== INITIALIZATION ==========
    loadData();
    showPage('home');
  </script>
</body>
</html>
